# Project4: do your best to optimize SM3 implementation (software)

## 运行环境

操作系统：Ubuntu 22.04.2 LTS 64位

编译环境：C++ 使用 g++ (Ubuntu 11.3.0-1ubuntu1~22.04.1) 11.3.0，
不使用编译优化

硬件环境：11th Gen Intel® Core™ i5-1135G7 @ 2.40G   16.0 GiB

---

## 优化途径

1：SM3杂凑过程中存在诸多“简易步骤”，例如：循环左移、P0置换、P1置换等等。
对于这些操作，我们使用宏来代替函数，通过预处理的方式进行加速。
例如计算循环左移：

``` C

#define lift32(input, n) ((input << n) | (input >> (32 - n)))

```

2：最终生成的杂凑值由上一步得到的V和消息扩展值运算得到。我们发现“消息扩展”步骤
仅仅依赖于输入B，可并行，因此我们将消息扩展进行提前运算，对消息扩展进行自动并行加速。

3：在计算中，我们对可以进行并行的循环函数进行循环展开，增大并行效率

---

## 结果展示

1:测试正确性：

根据文档，求“0x61, 0x62, 0x63”杂凑，得到：

66c7f0f4 62eeedd9 d1f2d46b dc10e4e2 4167c487 5cf2f7a2 297da02b 8f4ba8e0

验证正确。

2：测试效率：

| 文本大小（字节） | 运行时间（ms） |
| ---------------- | -------------- |
| 100              | 0.002          |
| 500              | 0.005          |
| 1000             | 0.01           |
| 2000             | 0.021          |
| 5000             | 0.058          |
| 10000            | 0.104          |
| 50000            | 0.509          |
| 100000           | 1.034          |

运行实例如图：
![Alt text](image.png)
